#include "adc_3.h"

void adc_3_gpio_init(void) {
	
	/* CONFIGURE INPUT PINS */
	/*
		PORT C PIN 2 IS USED BY ADC_3 TO DO A SINGLE
		CONVERSION ON CHANNEL 12. IT IS CONFIGURED AS
		ANALOG MODE, NO PULL-UP/PULL-DOWN.
	*/
	
	// ENABLE PORT A CLOCK
	RCC->AHB1ENR |= RCC_AHB1ENR_GPIOCEN;
	
	/* SET AS ANALOG */
	
	// PC2
	GPIOC->MODER |= (3 << 2*2);
	
	/* SET AS NO PULL-UP/PULL-DOWN */
	
	// PC2
	GPIOC->PUPDR &= ~(3 << 2*2);
	
}

void adc_3_config(void) {
	
	/*
		ADC_3 WILL CONVERT A SINGLE
		SAMPLE ON ADC CHANNEL 10.
	*/
		
	// ENABLE ADC
	RCC->APB2ENR |= RCC_APB2ENR_ADC3EN;
	
	// DISABLE CONVERSION
	ADC3->CR2 &= ~ADC_CR2_ADON;
	
	// CONFIGURE REGULAR CHANNEL SEQUENCE LENGTH TO 1 CONVERSION
	ADC3->SQR1 &= ~ADC_SQR1_L;
	
	// SELECT CHANNEL 6 AS FIRST AND ONLY CONVERSION
	ADC3->SQR3 |= 12;
	
	// SELECT 144 CYCLES PER SAMPLE FOR CONVERSION
	ADC3->SMPR1 |= (6 << 12);
	
	// ENABLE END OF CONVERSION INTERRUPT
	ADC3->CR1 |= ADC_CR1_EOCIE;
	
	// ENABLE ADC
	ADC3->CR2 |= ADC_CR2_ADON;
	
}


